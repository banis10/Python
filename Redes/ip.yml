---
## Playbook to get system time and append it to backup files

- hosts: localhost

  tasks:
  - name: Get ansible date/time facts
    setup:
      filter: "ansible_date_time"
      gather_subset: "!all"

  - name: Store DTG as fact
    set_fact:
      DTG: "{{ ansible_date_time.date }}"

  - name: Create Directory {{hostvars.localhost.DTG}}
    file:
      path: ~/proyecto/ips/{{hostvars.localhost.DTG}}
      state: directory
  run_once: true

- hosts: routers

  tasks:
  - name: Show IP int brief 
    ios_command:
      commands: show ip int brief  
    register: config

  - name: Save output to ~/proyecto/ips/
    copy:
      content: "{{config.stdout[0]}}"
      dest: "~/proyecto/ips/ship.txt"


- hosts: routers 

  vars:
    command_list:
    # - show etherchannel summary 
      - show cdp neigh 
    # - sh switch stack-ports
    # - sh switch 
    # - show environment all
    # - show ip ospf int brief 
    # - show ip ospf neigh 
    # - show cdp neighbors detail
    # - show version 
    # - show license usage 
    # - show clock
    # - show users
    # - show boot
    # - show int status | inc connected
    # - show arp
      - show ip interface brief | exc admin

  tasks:
  - name: Run the SHOW commands and save output 
    ios_command:
      commands: "{{ command_list }}"
    register: showoutput

  - name: "Put all the files together into one nice text file"
    template: 
      src: template.j2 
      dest: "~/proyecto/ips/{{hostvars.localhost.DTG}}/{{ inventory_hostname }}-{{hostvars.localhost.DTG}}-showoutput.txt"